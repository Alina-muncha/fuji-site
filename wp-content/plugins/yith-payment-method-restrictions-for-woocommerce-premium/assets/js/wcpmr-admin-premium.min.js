jQuery(function(t){var i=function(i){var e=[];return i&&t.each(i,function(t,i){e.push({id:t,text:i})}),{results:e}},e=function(i,e){var c=t.parseJSON(i.attr("data-selected")),n=[];return t(i.val().split(",")).each(function(t,i){n.push({id:i,text:c[i]})}),e(n)},c=function(t){return'<div class="selected-option" data-id="'+t.id+'">'+t.text+"</div>"},n=t("#yith-wcpmr-new-condition"),a=t("#yith-wcpmr-conditions-list"),r=t("#yith-wcpmr-rule-gateway"),s=t("#yith-wcpmr-bacs-payment-restriction-container"),o=t("#yith-wcpmr-bacs"),h=t("input[type=radio][name=yith_wcpmr_checked_account]"),l=t("#yith-wcpmr-bacs-account-select");n.on("click",function(i){i.preventDefault();var e={index:t(".yith-wcpmr-conditions-row").size(),action:"yith_wcpmr_add_condition_row"};t.ajax({type:"POST",data:e,url:yith_wcpmr_admin.ajaxurl,success:function(t){a.append(t)}})}),r.on("change",function(){"bacs"==t(this).val()?(s.fadeIn(1e3),h.trigger("change"),o.select2()):s.fadeOut(1e3)}),t(h).on("change",function(){t(this).is(":checked")&&("change_bacs_account"==t(this).val()?l.fadeIn(1e3):l.fadeOut(1e3))});var p={init:function(){t(document).on("click",".yith-wcpmr-delete-condition",this.delete_condition),t(document).on("change",".yith-wcpmr-get-type-restriction",this.yith_change),this.check_bacs_account(),this.show_fields()},check_bacs_account:function(){"bacs"==t("#yith-wcpmr-rule-gateway").val()?(t(".yith-wcpmr-bacs-payment-restriction").show(),t(".yith-wcpmr-bacs").select2(),h.trigger("change")):t(".yith-wcpmr-bacs-payment-restriction").hide()},delete_condition:function(){t(this).closest(".yith-wcpmr-conditions-row").remove()},show_fields:function(){t(".yith-wcpmr-li").each(function(){var i=t(this).closest(".yith-wcpmr-row");t(this).hasClass("yith-wcpmr-hide-rule-set")?i.hide():t(this).hasClass("yith-wcpmr-rule-set")&&(t(this).show(),t(this).hasClass("yith-wcpmr-select")&&(t(this).hasClass("yith-wcpmr-selector2")?p.yith_change(event,t(this),t(this).data("type")):t(this).select2()))})},yith_change:function(n,a,r){void 0===a&&(a=t(this)),void 0===r&&(r=t(this).val());var s=a.closest(".yith-wcpmr-conditions-row");switch(s.find(".yith-wcpmr-select2").hide(),s.find(".yith-wcpmr").css("display","none"),r){case"price":s.find('.yith-wcpmr-restriction-type option[value=""]').attr("selected","selected"),s.find(".yith-wcpmr-restriction-by-price").show(),s.find(".yith-wcpmr-rule-price").select2(),s.find(".yith-wcpmr-input-price").css("display","inline");break;case"category":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-categories").show(),s.find(".yith-wcpmr-categories").select2(),s.find(":input.yith-wcpmr-category-search").filter(":not(.enhanced)").each(function(){var n={url:yith_wcpmr_admin.ajaxurl,dataType:"json",quietMillis:250,data:function(t){return{term:t,action:"yith_wcpmr_category_search",security:yith_wcpmr_admin.search_categories_nonce}},cache:!0};yith_wcpmr_admin.before_3_0?n.results=i:n.processResults=i;var a={initSelection:yith_wcpmr_admin.before_3_0?e:null,formatSelection:yith_wcpmr_admin.before_3_0?c:null,multiple:t(this).data("multiple"),allowClear:!!t(this).data("allow_clear"),placeholder:t(this).data("placeholder"),minimumInputLength:t(this).data("minimum_input_length")?t(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:n};t(this).select2(a).addClass("enhanced").on("change",function(){}),t(document.body).trigger("wc-enhanced-select-init")});break;case"tag":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-tags").show(),s.find(".yith-wcpmr-tags").select2(),s.find(":input.yith-wcpmr-tags-search").filter(":not(.enhanced)").each(function(){var n={url:yith_wcpmr_admin.ajaxurl,dataType:"json",quietMillis:250,data:function(t){return{term:t,action:"yith_wcpmr_tag_search",security:yith_wcpmr_admin.search_tags_nonce}},cache:!0};yith_wcpmr_admin.before_3_0?n.results=i:n.processResults=i;var a={initSelection:yith_wcpmr_admin.before_3_0?e:null,formatSelection:yith_wcpmr_admin.before_3_0?c:null,multiple:t(this).data("multiple"),allowClear:!!t(this).data("allow_clear"),placeholder:t(this).data("placeholder"),minimumInputLength:t(this).data("minimum_input_length")?t(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:n};t(this).select2(a).addClass("enhanced").on("change",function(){}),t(document.body).trigger("wc-enhanced-select-init")});break;case"product":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-product").show(),s.find(".yith-wcpmr-product-search").css("display","inline"),t(document.body).trigger("wc-enhanced-select-init");break;case"geolocalization":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-geolocalization").show(),s.find(".yith-wcpmr-geolocalization-search").select2();break;case"role":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-role").show(),s.find(".yith-wcpmr-role-search").select2();break;case"user":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-user").show(),s.find(".yith-wcpmr-user-search").select2(),t(document.body).trigger("wc-enhanced-select-init");break;case"membership":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-membership").show(),s.find(".yith-wcpmr-membership-search").select2();break;case"subscription":s.find(".yith-wcpmr-restriction-by").show(),s.find(".yith-wcpmr-restriction-type").select2(),s.find(".yith-wcpmr-select2-subscription").show(),s.find(".yith-wcpmr-subscription-search").css("display","inline"),t(document.body).trigger("wc-enhanced-select-init")}}},m={init:function(){t("a.add").on("click",this.add_new_row),t(document).on("click","#yith-wcpmr-custom-fields-tab-actions-save",this.save_bacs_account)},add_new_row:function(i){i.preventDefault(),t(".yith_wcpmr_bank_accounts").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={index:t("tr.yith-wcpmr-bacs-account").size(),action:"yith_wcpmr_add_bacs_account_row"};t.ajax({type:"POST",data:e,url:yith_wcpmr_admin.ajaxurl,success:function(i){t(".yith-wcpmr-accounts").append(i),t(".yith_wcpmr_bank_accounts").unblock()},complete:function(){}})},save_bacs_account:function(i){i.preventDefault(),t(".yith_wcpmr_bank_accounts").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={account_name:t("input[name='account_name[]']").map(function(){return t(this).val()}).get(),account_number:t("input[name='account_number[]']").map(function(){return t(this).val()}).get(),bank_name:t("input[name='bank_name[]']").map(function(){return t(this).val()}).get(),sort_code:t("input[name='sort_code[]']").map(function(){return t(this).val()}).get(),iban:t("input[name='iban[]']").map(function(){return t(this).val()}).get(),bic:t("input[name='bic[]']").map(function(){return t(this).val()}).get(),action:"yith_wcpmr_save_bacs_account"};t.ajax({type:"POST",data:e,url:yith_wcpmr_admin.ajaxurl,success:function(i){t(".yith_wcpmr_bank_accounts").unblock()},complete:function(){}})}};p.init(),m.init()});